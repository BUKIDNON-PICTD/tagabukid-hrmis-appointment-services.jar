import com.rameses.annotations.*
import com.rameses.common.*
import com.rameses.services.extended.*;

class TagabukidHRMISPDSReportService 
{
	@Service("PersistenceService")
    def persistenceSvc;

	@Service('DateService')
	def dtSvc 

	@Env
	def env;

	@ProxyMethod
	public def getTestReportData(params){
		def data =[:]
			
			def pdsentity = persistenceSvc.read([_schemaname: 'hrmis_pds', objid:params.objid])

			if (pdsentity.familyfatherInfos.size > 0){
				pdsentity.familyfatherInfos[0].father = persistenceSvc.read( [_schemaname:'entityindividual', objid:pdsentity.familyfatherInfos[0].father.objid])
			}
			if (pdsentity.familymotherInfos.size > 0){
				pdsentity.familymotherInfos[0].mother = persistenceSvc.read( [_schemaname:'entityindividual', objid:pdsentity.familymotherInfos[0].mother.objid])
			}
			if (pdsentity.familyspouseInfos.size > 0){
				pdsentity.familyspouseInfos[0].spouse = persistenceSvc.read( [_schemaname:'entityindividual', objid:pdsentity.familyspouseInfos[0].spouse.objid])
			}
			if (pdsentity.familychildInfos.size > 0){
				pdsentity.familychildInfos.each{
					it.child = persistenceSvc.read( [_schemaname:'entityindividual',objid:it.child.objid])
				}
			}
			
			pdsentity.family = [
				fatherdata : pdsentity.familyfatherInfos[0],
				motherdata : pdsentity.familymotherInfos[0],
				spousedata : pdsentity.familyspouseInfos[0],
				childdata : pdsentity.familychildInfos
			]

			def Levels = [
				[ level : "ELEMENTARY" ],
				[ level : "SECONDARY" ],
				[ level : "VOCATIONAL / TRADE COURSE" ],
				[ level : "COLLEGE" ],
				[ level : "GRADUATE STUDIES" ],
			]
			// pdsentity.educationalInfos + Levels
			Levels.each{ a ->
				if (pdsentity.educationalInfos.findAll{it.level == a.level}.size()==0){
					pdsentity.educationalInfos << a
				}
			}


			data.reportdata = pdsentity
			println pdsentity
			data.parameters = [
				LGUNAME  :"PG-BUKIDNON, REGION 10",
				LGUADDRESS : "Provincial Capitol, City of Malaybalay",
				TITLE :"PERSONAL DATA SHEET",
			]
		return data;
	}

}
